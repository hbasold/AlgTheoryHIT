The HelloWorld of free algebras: groups.
Specifically, we construct free groups and show that free group without
generators is isomorphic to the trivial group with one element.

\begin{code}
{-# OPTIONS --without-K --rewriting #-}

module Groups where

open import Universes
open import lib.Basics
open import lib.types.Unit
open import lib.Funext
open import Fin
open import Terms
open import AlgebraicTheories
open import FreeAlgebra
\end{code}

The signature of groups has three operations: the unit as nullary operation,
the inverse as unary operation and multiplication as binary operation.
\begin{code}
data GroupSym : ğ“¤â‚€ Ì‡ where
  unit : GroupSym
  inv : GroupSym
  mul : GroupSym

group-ar : GroupSym â†’ Type lzero
group-ar unit  = âŠ¥
group-ar inv   = âŠ¤
group-ar mul   = Fin 2

GroupSig : Signature ğ“¤â‚€ ğ“¤â‚€
GroupSig = record
  { sym = GroupSym
  ; ar = group-ar
  }
\end{code}

We simplify notation a bit and introduce constructors for complex group
terms.
This allows us to write, for example, t â€£ u for the multiplication of terms
t and u that are generated by the signature of groups.
Similarly, we write - t for the inverse and e for the unit term.
Finally, injection of variables x is written â†‘ x.
\begin{code}
infixl 80 -_ â†‘_
infixl 50 _â€£_

args2 : âˆ€ {X : ğ“¤â‚€ Ì‡} â†’ X â†’ X â†’ FinMapDom X 2
args2 x y = dom-S x (dom-S y dom-Z)

fmap2  : âˆ€ {X} â†’ X â†’ X â†’ Fin 2 â†’ X
fmap2 x y = Fin-map (args2 x y)

_â€£_ : {X : ğ“¤â‚€ Ì‡} â†’ Term GroupSig X â†’ Term GroupSig X â†’ Term GroupSig X
t â€£ u = node mul (fmap2 t u)

-_ : {X : ğ“¤â‚€ Ì‡} â†’ Term GroupSig X â†’ Term GroupSig X
-_ t = node inv Î» _ â†’ t

e : {X : ğ“¤â‚€ Ì‡} â†’ Term GroupSig X
e = node unit âŠ¥-elim

â†‘_ : {X : ğ“¤â‚€ Ì‡} â†’ X â†’ Term GroupSig X
â†‘_ = var

\end{code}

The equational theory of groups has associativity with three variables:
âˆ€ x y z. x âˆ™ (y âˆ™ z) = (x âˆ™ y) âˆ™ z.
All other axioms only have one variable.
\begin{code}
data GroupEqAr (X : ğ“¤â‚€ Ì‡) : ğ“¤â‚€ Ì‡ where
  assoc : X â†’ X â†’ X â†’ GroupEqAr X
  unitâ‚— : X â†’ GroupEqAr X
  unitáµ£ : X â†’ GroupEqAr X
  inváµ£ : X â†’ GroupEqAr X
  invâ‚— : X â†’ GroupEqAr X
\end{code}

We use the idea to represent equations by natural transformations l and r,
where l represents the left- and r the right-hand side of an equation.
With this idea in mind, the following just states the usual group axioms.
\begin{code}
GroupEqs : âˆ€ {X} â†’ Rel (Term GroupSig X) ğ“¤â‚€
GroupEqs = Nat-to-Rel F l r
  where
    F : ğ“¤â‚€ âŸ¶ ğ“¤â‚€
    F X = GroupEqAr X

    l r : F â‡’ Term GroupSig
    l (assoc x y z)  = â†‘ x â€£ (â†‘ y â€£ â†‘ z)
    l (unitâ‚— x)      = e â€£ â†‘ x
    l (unitáµ£ x)      = â†‘ x â€£ e
    l (inváµ£ x)       = â†‘ x â€£ -(â†‘ x)
    l (invâ‚— x)       = - (â†‘ x) â€£ â†‘ x

    r (assoc x y z)  = (â†‘ x â€£ â†‘ y) â€£ â†‘ z
    r (unitâ‚— x)      = â†‘ x
    r (unitáµ£ x)      = â†‘ x
    r (inváµ£ x)       = e
    r (invâ‚— x)       = e

\end{code}

We pack the signature and equations into an algebraic theory.
\begin{code}
ğ“– : AlgTheory ğ“¤â‚€ ğ“¤â‚€ ğ“¤â‚€
ğ“– = record
  { sig = GroupSig ; eqs = GroupEqs }

\end{code}

Given this theory, we can generate the free group as free algebra over the
group theory ğ“–.
\begin{code}
InitialGroup : Algebra ğ“–
InitialGroup = InitialAlgebra

InitialGroup-Initial : IsInitial InitialGroup
InitialGroup-Initial = FreeAlg-Initial

open Algebra InitialGroup renaming (carrier to G; algebra to a; algebra* to a*)
\end{code}

Let us introduce some notation for the unit, inverse and multiplication in the
free group.
\begin{code}
e* : G
e* = a* e

inv* : G â†’ G
inv* g = a inv (Î» _ â†’ g)

infixl 50 _âŸ_

_âŸ_ : G â†’ G â†’ G
gâ‚ âŸ gâ‚‚ = a mul (fmap2 gâ‚ gâ‚‚)
\end{code}

In what follows, we prove that the free group is just the trivial group with
one element.
To this end, we need firts that âŠ¥-elim is the unique map out of âŠ¥.
\begin{code}
âŠ¥-elim-unique : âˆ€ {X : ğ“¤â‚€ Ì‡} (f : âŠ¥ â†’ X) â†’ f == âŠ¥-elim
âŠ¥-elim-unique f = FunextNonDep.Î»=-nondep âŠ¥-elim
\end{code}

Next, we prove some computation rules for the operations in the free group.
\begin{code}
e*-Î² : a unit âŠ¥-elim == e*
e*-Î² = ap (a unit) (! (âŠ¥-elim-unique (a* âˆ˜ âŠ¥-elim)))

â€£-Î² : âˆ€ t u â†’ a* (t â€£ u) == a* t âŸ a* u
â€£-Î² t u =
  a* (t â€£ u) =âŸ¨ idp âŸ©
  a* (node mul (fmap2 t u))    =âŸ¨ idp âŸ©
  a mul (a* âˆ˜ (fmap2 t u))     =âŸ¨ ap (a mul) (Fin-map-âˆ˜ a* _) âŸ©
  a mul (fmap2 (a* t) (a* u))  =âŸ¨ idp âŸ©
  a* t âŸ a* u                  =âˆ

inv-Î² : âˆ€ t â†’ a* (- t) == a inv (Î» _ â†’ a* t)
inv-Î² t = idp

flip-inv-var : âˆ€ x â†’ a* (â†‘ (inv* x)) == a* (- (â†‘ x))
flip-inv-var x =
  a* (â†‘ (inv* x))              =âŸ¨ idp âŸ©
  inv* x                       =âŸ¨ idp âŸ©
  a inv (Î» _ â†’ x)              =âŸ¨ idp âŸ©
  a inv (Î» _ â†’ a* (â†‘ x))       =âŸ¨ idp âŸ©
  a* (node inv (Î» _ â†’ (â†‘ x)))  =âŸ¨ idp âŸ©
  a* (- (â†‘ x))                 =âˆ
\end{code}

With these lemmas under our belt, we can lift the group laws to the free group.
\begin{code}
unitáµ£* : âˆ€ x â†’ x âŸ e* == x
unitáµ£* x =
  x âŸ e*                                  =âŸ¨ idp âŸ©
  a* (â†‘ x) âŸ a* e                         =âŸ¨ ! (â€£-Î² _ _) âŸ©
  a* ((â†‘ x) â€£ e)                          =âŸ¨ resp-eq (unitáµ£ x , idp , idp) âŸ©
  a* (â†‘ x)                                =âŸ¨ idp âŸ©
  x                                       =âˆ

invâ‚—* : âˆ€ x â†’ inv* x âŸ x == e*
invâ‚—* x =
  inv* x âŸ x                  =âŸ¨ idp âŸ©
  a* (â†‘ (inv* x)) âŸ a* (â†‘ x)  =âŸ¨ idp âŸ©
  a* (- (â†‘ x)) âŸ a* (â†‘ x)     =âŸ¨ ! (â€£-Î² _ _) âŸ©
  a* (- (â†‘ x) â€£ â†‘ x)          =âŸ¨ resp-eq (invâ‚— x , idp , idp) âŸ©
  a* e                        =âŸ¨ idp âŸ©
  e*                          =âˆ
\end{code}

From the group laws, we can prove the standard result that the inverse of the
unit is the unit itself.
\begin{code}
unit-inv : inv* e* == e*
unit-inv =
  inv* e*       =âŸ¨ ! (unitáµ£* (inv* e*)) âŸ©
  inv* e* âŸ e*  =âŸ¨ invâ‚—* e* âŸ©
  e*            =âˆ
\end{code}

Now, we introduce the trivial group.
\begin{code}
b : (s : GroupSym) â†’ (Î± : group-ar s â†’ âŠ¤) â†’ âŠ¤
b = Î» s Î± â†’ tt

TrivGroup : Algebra ğ“–
TrivGroup = record
  { pre-algebra = record
    { carrier      = âŠ¤
    ; carrier-set  = Unit-level
    ; algebra      = b
    }
  ; is-algebra = record { resp-eq = Î» x â†’ idp }
  }
\end{code}

From initiality, we obtain a homomorphism from the free group G into the
trivial group.
\begin{code}
Initialâ†’Triv : Homomorphism InitialGroup TrivGroup
Initialâ†’Triv = InitialHom TrivGroup
\end{code}

In the other direction, we map the single point to the unit in the free
group.
Using the group laws, it follows that this gives a homomorphism.
\begin{code}
h : âŠ¤ â†’ G
h = Î» _ â†’ e*

h-resp : (s : GroupSym) (Î± : group-ar s â†’ âŠ¤) â†’ e* == a s (h âˆ˜ Î±)
h-resp unit Î± = ap (a unit) (FunextNonDep.Î»=-nondep âŠ¥-elim)
h-resp inv Î± =
  e*                =âŸ¨ ! unit-inv âŸ©
  inv* e*           =âŸ¨ idp âŸ©
  a inv (Î» _ â†’ e*)  =âŸ¨ idp âŸ©
  a inv (h âˆ˜ Î±)     =âˆ
h-resp mul Î± =
  e*                   =âŸ¨ ! (unitáµ£* e*) âŸ©
  e* âŸ e*              =âŸ¨ idp âŸ©
  a mul (fmap2 e* e*)  =âŸ¨ ap (a mul) (! (Fin-map-unique _)) âŸ©
  a mul (h âˆ˜ Î±)        =âˆ

Trivâ†’Initial : Homomorphism TrivGroup InitialGroup
Trivâ†’Initial = record
  { map = h
  ; resp-ops = h-resp
  }
  where
\end{code}

Now that we have homomorphism in both directions between the free group
and the trivial group, it remains to show that these are inverses.
This follows the usual reasoning by appealing to uniqueness of homomorphism
out of initial objects.
\begin{code}
InitialIsTrivial : InitialGroup â‰… TrivGroup
InitialIsTrivial = record
  { from = Initialâ†’Triv
  ; to = Trivâ†’Initial
  ; invâ‚ = FunextNonDep.Î»=-nondep (Î» x â†’ idp)
  ; invâ‚‚ = lem
  }
  where
    !G : G â†’ G
    !G = Homomorphism.map (InitialHom InitialGroup)

    !âŠ¤ : G â†’ âŠ¤
    !âŠ¤ = InitialAlgebra-iter TrivGroup

    lemâ‚ : idf G == !G
    lemâ‚ = IsInitial.!-unique FreeAlg-Initial (id-hom InitialGroup)

    lemâ‚‚ : (s : GroupSym) (Î± : group-ar s â†’ G) â†’
           h (!âŠ¤ (a s Î±)) == a s ((h âˆ˜ !âŠ¤) âˆ˜ Î±)
    lemâ‚‚ s Î± =
      h (!âŠ¤ (a s Î±))      =âŸ¨ ap h idp âŸ©
      h (b s (!âŠ¤ âˆ˜ Î±))    =âŸ¨ h-resp s (!âŠ¤ âˆ˜ Î±) âŸ©
      a s (h âˆ˜ !âŠ¤ âˆ˜ Î±)    =âŸ¨ ap (a s) idp âŸ©
      a s ((h âˆ˜ !âŠ¤) âˆ˜ Î±)  =âˆ

    hâˆ˜!âŠ¤-hom : Homomorphism InitialGroup InitialGroup
    hâˆ˜!âŠ¤-hom = record
      { map = h âˆ˜ !âŠ¤
      ; resp-ops = lemâ‚‚
      }

    lem : h âˆ˜ !âŠ¤ == idf G
    lem =
      h âˆ˜ !âŠ¤ =âŸ¨ IsInitial.!-unique InitialGroup-Initial hâˆ˜!âŠ¤-hom âŸ©
      !G =âŸ¨ ! lemâ‚ âŸ©
      idf G =âˆ
\end{code}
